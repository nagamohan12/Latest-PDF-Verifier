<% if @user.errors.any? -%>
  $("#new_user_form").html("<%= escape_javascript(render :partial => 'new', :locals => {:user => @user})%>");
<% else -%>
  $("#new_user_form").hide();
  $("#new_form").show();
  $("#new_user_form").html("<%= escape_javascript(render :partial => 'new', :locals => {:user => User.new})%>");
  $('#users_list tr:last').after("<%= escape_javascript(render :partial => 'user', :locals => {:user => @user})%>")
<% end -%>